var pmcPiano;!function(){"use strict";var e={832:function(e,n){var t=this&&this.__assign||function(){return t=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var a in n=arguments[t])Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);return e},t.apply(this,arguments)},r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(a,i){function o(e){try{s(r.next(e))}catch(e){i(e)}}function c(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?a(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,c)}s((r=r.apply(e,n||[])).next())}))},a=this&&this.__generator||function(e,n){var t,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(o=0)),o;)try{if(t=1,r&&(a=2&c[0]?r.return:c[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,c[1])).done)return a;switch(r=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,r=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){o.label=c[1];break}if(6===c[0]&&o.label<a[1]){o.label=a[1],a=c;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(c);break}a[2]&&o.ops.pop(),o.trys.pop();continue}c=n.call(e,o)}catch(e){c=[6,e],r=0}finally{t=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},i=this&&this.__spreadArray||function(e,n,t){if(t||2===arguments.length)for(var r,a=0,i=n.length;a<i;a++)!r&&a in n||(r||(r=Array.prototype.slice.call(n,0,a)),r[a]=n[a]);return e.concat(r||Array.prototype.slice.call(n))};Object.defineProperty(n,"__esModule",{value:!0}),n.pmcPianoEntitlements=void 0,n.pmcPianoEntitlements={subscriberData:void 0,combineSubscriberData:function(e,n){var r,a,o,c,s;return t(t({user:{acct:{type:"Individual"}}},e),{user:t(t(t({},e.user),Object.fromEntries(Object.entries(null==n?void 0:n.user).filter((function(e){var n=e[1];return null!=n&&("string"!=typeof n||("string"==typeof n&&"".concat(n).length)>0)})))),{acct:t(t({},e.user.acct),Object.fromEntries(Object.entries(null===(r=null==n?void 0:n.user)||void 0===r?void 0:r.acct).filter((function(e){var n=e[1];return null!=n&&("string"!=typeof n||("string"==typeof n&&"".concat(n).length)>0)})))),entitlements:i(i([],null!==(o=null===(a=null==e?void 0:e.user)||void 0===a?void 0:a.entitlements)&&void 0!==o?o:[],!0),null!==(s=null===(c=null==n?void 0:n.user)||void 0===c?void 0:c.entitlements)&&void 0!==s?s:[],!0)})})},getSubscriberData:function(){return r(void 0,void 0,Promise,(function(){var e,n,r,i,o,c,s,l,u,d,b,p,f,v,g;return a(this,(function(a){switch(a.label){case 0:return e=window.pmcPiano.piano,n=window.pmcPiano.pianoApi,r=window.pmcPiano.entitlements,[4,n.importWpApiFetch()];case 1:if(i=a.sent().default,o=e.getUser(),!(c=null==o?void 0:o.email))return e.canDebug&&console.log("PMC: Piano: No email available from Piano user, returning empty SubscriberData"),[2,void 0];a.label=2;case 2:return a.trys.push([2,5,,6]),c?(u="/wp-json/pmc/piano/v1/subscriptions/get/".concat(encodeURIComponent(c),"/"),[4,i({url:"".concat(window.location.protocol,"//").concat(window.location.host).concat(u)})]):[3,4];case 3:d=a.sent(),l=(null==d?void 0:d.user)?d:{},a.label=4;case 4:return[3,6];case 5:return b=a.sent(),e.canDebug&&console.log("PMC: Piano: Error retrieving subscriber data from Salesforce API",b),[3,6];case 6:return[4,n.getAccessList()];case 7:p=a.sent();try{Array.isArray(p)&&p.length>0&&(null===(g=p[0])||void 0===g?void 0:g.user)&&(f=p[0],s={data_type:"piano",user:{family_name:f.user.last_name,given_name:f.user.first_name,email:f.user.email,acct:{contact_id:f.user.uid,name:[f.user.first_name,f.user.last_name].filter((function(e){return e&&e.length>0})).join(" ").trim()},entitlements:p.map((function(e){return e.resource.name}))}})}catch(n){e.canDebug&&console.error("PMC: Piano: Error retrieving Piano access list",n)}return e.canDebug&&console.log("PMC: Piano: Retrieved subscriber data from Piano API",l,s),[2,(v=l&&s?r.combineSubscriberData(l,s):null!=l?l:s)?t({data_type:"piano"},v):void 0]}}))}))},setSubscriberData:function(){var e=window.pmcPiano.entitlements,n=window.pmcPiano.piano;if(!n.hasUser())return n.canDebug&&console.log("PMC: Piano: No Piano user, skipping subscriber data load"),void e.triggerSubscriberDataLoaded();e.getSubscriberData().then((function(t){e.subscriberData=t,n.canDebug&&console.log("PMC: Piano: Loaded subscriber data",e.subscriberData),e.triggerSubscriberDataLoaded()}))},subscriberDataLoadedCallbacks:[],cxenseCallbackCalled:!1,triggerSubscriberDataLoaded:function(){var e=window.pmcPiano.entitlements;if(window.pmcPiano.piano,0>=e.subscriberDataLoadedCallbacks.length){if(e.cxenseCallbackCalled)return;setTimeout(e.triggerSubscriberDataLoaded.bind(e),500)}else{for(var n=0,t=e.subscriberDataLoadedCallbacks;n<t.length;n++)(0,t[n])(e.subscriberData);e.subscriberDataLoadedCallbacks=[],e.cxenseCallbackCalled||setTimeout(e.triggerSubscriberDataLoaded.bind(e),500)}},onPianoLoginSuccess:function(){var e;"piano"===(null===(e=window.pmcPianoData)||void 0===e?void 0:e.loginProvider)&&window.tp.push(["addHandler","loginSuccess",function(e){"PIANOID"==e.source&&location.reload()}])},on_subscriber_data_loaded:function(e){var n,t=window.pmcPiano.entitlements,r=window.pmcPiano.piano;try{if("piano"!==(null===(n=window.pmcPianoData)||void 0===n?void 0:n.loginProvider))return r.canDebug&&console.log("PMC: Piano: Login provider is not Piano, skipping subscriber data loading"),void e(void 0);if(t.subscriberData)return void e(t.subscriberData);r.canDebug&&console.log("PMC: Piano: Subscriber data not yet loaded, adding callback",t.subscriberData),t.subscriberDataLoadedCallbacks.push(e)}catch(n){r.canDebug&&console.log("PMC: Piano: Error loading subscriber data"),e(void 0)}}},e.exports=n.pmcPianoEntitlements}},n={},t=function t(r){var a=n[r];if(void 0!==a)return a.exports;var i=n[r]={exports:{}};return e[r].call(i.exports,i,i.exports,t),i.exports}(832);(pmcPiano=void 0===pmcPiano?{}:pmcPiano).entitlements=t}();